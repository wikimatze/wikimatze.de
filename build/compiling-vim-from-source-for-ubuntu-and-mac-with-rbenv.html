<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compiling Vim from source for Ubuntu and Mac with ruby and python support</title>
  <meta name="author" content="Matthias Günther" >
  
  <meta name="description" content="Writings, and talks by Matthias Günther. Günther works at MyHammer, loves painting Warhammer figures, and enjoys making cakes.">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet">

  <link href="/css/bootstrap.css" rel="stylesheet" media="screen, projection">
  <link href="/css/bootstrap-responsive.css" rel="stylesheet" media="screen, projection">
  <link href="/css/base.css" rel="stylesheet" media="screen, projection">
  <link href="/css/pygments.css" rel="stylesheet" media="screen, projection">

  <link href="http://feeds.feedburner.com/guenther" rel="alternate" type="application/rss+xml" title="RSS feed of Matthias Günther">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
  <div class="container">
    <div class="row-fluid">
      <div class="span12">
        <div class="span5">
          <span id="title">
            <a href="/index.html">wikimatze</a>
          </span>
        </div>
        <div class="span7">
          <nav>
            <ul class="nav nav-pills">
              <li><a href="http://feeds.feedburner.com/guenther" target="_blank"><img src="/images/rss.png" alt="RSS"></a></li>
              <li><a href="https://twitter.com/wikimatze" target="_blank"><img src="/images/twitter.png" alt="Twitter"></a></li>
              <li><a href="https://github.com/matthias-guenther" target="_blank"><img src="/images/github.png" alt="GitHub"></a></li>
              <li><a href="/about.html">About</a></li>
              <li><a href="/talks.html">Talks</a></li>
              <li><a href="/projects.html">Projects</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
<!--
    <div id="ribbon">
      <a href="https://github.com/matthias-guenther" target="_blank">Fork me on Github</a>
    </div>
    -->

    <div class="row-fluid">
      <div class="span10 offset1">
        
        <header><h1>Compiling Vim from source for Ubuntu and Mac with ruby and python support</h1></header>
        
        <article class="post">
  <header>
    <div class="author">
      Posted on <time datetime="2012-02-19" pubdate>2012-02-19</time>
    </div>
    <div class="right">
  <a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-via="wikimatze">Tweet</a>
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
  <a href="http://twitter.com/wikimatze" class="twitter-follow-button" data-show-count="false">Follow wikimatze</a>
    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
</div>


    <div class="clearer"></div>
  </header>
  <div class="clearer"></div>
  <p><em>This article describes how to build <a href="http://www.vim.org/">Vim</a> (vim and gvim) from the source and compile it against a
predefined version of <a href="http://www.ruby-lang.org/en/">ruby</a> installed with
<a href="https://github.com/sstephenson/rbenv/">rbenv</a>. In the first chapter I&rsquo;m describing how to build it from source for
Ubuntu. The second part describes how to build for <a href="https://github.com/b4winckler/macvim/">MacVim</a>.</em></p>

<p>By installing Vim with ruby support from the sources, it is build against the system wide installation of ruby.  If you
already installed Vim and/or ruby with <code>sudo apt-get install vim</code> (or <code>sudo apt-get install ruby</code>) or with <code>brew install
vim</code> (e.g.  <code>brew install ruby</code>) if you are using OS X, remove it completely from your system to install the latest
version of Vim.</p>

<h2>Install rbenv</h2>

<p>I&rsquo;m installing <em>rbenv</em> on different machines so I created the following script (named <em>rbenv_install.sh</em>) to install
<strong>ruby 1.9.2-p320</strong>:</p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> <span class="nv">$HOME</span>
sudo rm -rf .rbenv
git clone git://github.com/sstephenson/rbenv.git .rbenv
<span class="nb">echo</span> <span class="s1">&#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39;</span> &gt;&gt; ~/.bash_profile

<span class="c"># install steps for rbenv-install command</span>
<span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads
sudo rm -rf ruby-build
git clone git://github.com/sstephenson/ruby-build.git
<span class="nb">cd </span>ruby-build
sudo bash install.sh

<span class="c"># updating the current shell</span>
<span class="nb">cd</span> <span class="nv">$HOME</span>
<span class="nb">exec</span> <span class="nv">$SHELL</span>
<span class="nb">source</span> <span class="nv">$HOME</span>/.bash_profile

rbenv-install 1.9.2-p290
rbenv rehash
<span class="nb">exec</span> <span class="nv">$SHELL</span>
</code></pre></div>


<p>After this try the following:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>rbenv global 1.9.2-p320
<span class="nv">$ </span>rbenv <span class="nb">local </span>1.9.2-p320
<span class="nv">$ </span>ruby -v
<span class="o">=</span>&gt; ruby 1.9.2p320 <span class="o">(</span>2012-04-20 revision 35421<span class="o">)</span> <span class="o">[</span>i686-linux<span class="o">]</span>
</code></pre></div>


<p>The crowd applauds.</p>

<h2>Get the latest version of Python</h2>

<p>This will be put in the <code>$HOME/lib</code> folder:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mkdir <span class="nv">$HOME</span>/lib
<span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads
<span class="nv">$ </span>wget http://www.python.org/ftp/python/2.7.3/Python-2.7.3.tar.bz2
<span class="nv">$ </span>tar xjvf Python-2.7.3.tar.bz2
<span class="nv">$ </span><span class="nb">cd </span>Python-2.7.3
<span class="nv">$ </span>./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/lib
<span class="nv">$ </span>make <span class="o">&amp;&amp;</span> make install
<span class="nv">$ </span>make inclinstall <span class="c"># install headers, otherwise Vim won&#39;t have Python support</span>
<span class="nv">$ </span><span class="nb">hash</span> -r
</code></pre></div>


<h2>Get the latest version of Vim</h2>

<p>Visit <a href="http://www.vim.org/download.php/">vim.org</a> and select the right download for your operation system (mainly Unix).
If you are using a Unix system yo can get the latest Vim from <a href="ftp://ftp.vim.org/pub/vim/unix/">here</a>, download and
unzip it:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads
<span class="nv">$ </span>wget ftp://ftp.vim.org/pub/vim/unix/vim-7.3.tar.bz2
<span class="nv">$ </span>tar -xjvf vim-7.3.tar.bz2
</code></pre></div>


<p>You can also get the latest Vim version from the git repository with the following command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads
<span class="nv">$ </span>git clone https://github.com/b4winckler/vim
<span class="nv">$ </span><span class="nb">cd </span>vim
<span class="nv">$ </span>git tag -l
<span class="nv">$ </span>git checkout v7-3-548
</code></pre></div>


<h2>Compiling Vim and Gvim</h2>

<p>To install Gvim on Ubuntu we need to install additional packages on our machine. The following snippets describe the
packages for Ubuntu:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sudo apt-get install libncurses-dev libgnome2-dev <span class="se">\</span>
 libgtk2.0-dev libatk1.0-dev libbonoboui2-dev libcairo2-dev <span class="se">\</span>
 libx11-dev libxpm-dev libxt-dev
</code></pre></div>


<p>Since we are now having the Vim sources under <code>$HOME/Downloads/vim</code> it&rsquo;s time to start the compilation. First we need to
configure our compilation:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads/vim
<span class="nv">$ </span>./configure --prefix<span class="o">=</span>/usr/local <span class="se">\</span>
    --enable-gui<span class="o">=</span>no <span class="se">\</span>
    --without-x <span class="se">\</span>
    --disable-nls <span class="se">\</span>
    --with-tlib<span class="o">=</span>ncurses <span class="se">\</span>
    --enable-multibyte <span class="se">\</span>
    --enable-rubyinterp <span class="se">\</span>
    --enable-pythoninterp <span class="se">\</span>
    --with-python-config-dir<span class="o">=</span><span class="nv">$HOME</span>/lib/python2.7/config/ <span class="se">\</span>
    --with-mac-arch<span class="o">=</span>x86_64 <span class="se">\</span>
    --with-features<span class="o">=</span>huge <span class="se">\</span>
    --enable-gui<span class="o">=</span>gnome2
</code></pre></div>


<p>Let&rsquo;s get over the heavy stuff:</p>

<ul>
<li><code>--prefix=/usr/local</code> &ndash; place of the binaries of the installed Vim installation (check the <code>/usr/local/bin</code>) &ndash; there
will be the executable binaries</li>
<li><code>--enable-rubyinterp</code> &ndash; says you want to build Vim with the default ruby installation (in our case
<code>/home/mg/.rbenv/shims/ruby</code>)</li>
<li><code>--enable-gui=gnome2</code> &ndash; building Vim with Gvim support (if you don&rsquo;t want Gvim than you can leave this line out)</li>
</ul>


<p>After configuring the compilation check if the console response contains the following terms:</p>

<div class="highlight"><pre><code class="bash">checking --with-ruby-command argument... defaulting to ruby
checking <span class="k">for </span>ruby... <span class="o">(</span>cached<span class="o">)</span> /home/mg/.rbenv/shims/ruby
checking Ruby version... OK
checking Ruby header files... /home/mg/.rbenv/versions/1.9.2-p320/include/ruby-1.9.1
</code></pre></div>


<p>If you can&rsquo;t see the lovely <strong>Ok</strong>, your Vim compilation will probably not have ruby support. After that we can build
the configuration, install, and clean everything up:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/Downloads/vim
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
<span class="nv">$ </span>sudo make clean
</code></pre></div>


<h2>Check the installation</h2>

<p>Open a new session or perform <code>exec $SHELL</code> to reboot your Shell. You will see the fresh installed version of Vim:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>which vim
/usr/local/bin/vim

<span class="nv">$ </span>which gvim
/usr/local/bin/gvim
</code></pre></div>


<p>Next check is to get the correct &mdash;version of <code>vim</code> and <code>gvim</code> with the following commands:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>vim --version | ack ruby
<span class="nv">$ </span>vim --version | ack python
<span class="nv">$ </span>gvim --version | ack ruby
<span class="nv">$ </span>gvim --version | ack python
</code></pre></div>


<p>If both commands return <strong>+ruby</strong> and <strong>+python</strong>, you are fine, and got the achievement <em>&ldquo;I installed vim form source
with ruby support on my own&rdquo;</em>. You should now be able to run the
<a href="https://github.com/matthias-guenther/hammer.vim">Hammer.vim</a> plugin &ndash; install it, start it with <code>:Hammer</code>, install the
missing gems and if you are able to run <code>:Hammer</code> without any missing dependencies, you have setup everything correct.</p>

<h2>Installing MacVim from source</h2>

<p>The ways are nearly the same as mentioned above: Install rbenv as mentioned in the steps before.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/Download
<span class="nv">$ </span>git clone git://github.com/b4winckler/macvim.git
</code></pre></div>


<p>Next step is to <strong>configure</strong> MacVim for OSX:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>macvim/src
<span class="nv">$ </span>./configure --prefix<span class="o">=</span>/usr/local <span class="se">\</span>
              --with-features<span class="o">=</span>huge <span class="se">\</span>
              --enable-rubyinterp <span class="se">\</span>
              --enable-pythoninterp <span class="se">\</span>
              --enable-perlinterp <span class="se">\</span>
              --enable-cscope
</code></pre></div>


<p>After configuring the compilation check the console response after the following terms:</p>

<div class="highlight"><pre><code class="bash">checking --with-ruby-command argument... defaulting to ruby
checking <span class="k">for </span>ruby... /Users/helex/.rbenv/shims/ruby
checking Ruby version... OK
checking Ruby header files... /Users/helex/.rbenv/versions/1.9.2-p320/include/ruby-1.9.1
</code></pre></div>


<p>When this is finished, it is time <code>build</code> MacVim with make:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>make
</code></pre></div>


<p>Next step is to run the MacVim installation:</p>

<div class="highlight"><pre><code class="bash">open MacVim/build/Release/MacVim.app
</code></pre></div>


<p>The window should open MacVim. Run the following command in the MacVim quickfix window:</p>

<div class="highlight"><pre><code class="bash">:ruby puts <span class="s2">&quot;MacVim&quot;</span>
</code></pre></div>


<p>In the next step, you can drop the <strong>MacVim.app</strong> icon in your Application folder and you are done.</p>

<h2>Conclusion</h2>

<p>It was a pain to gather the information for building vim by source with rbenv. Duration of finding that was: ~ <strong>6 h</strong>.
I&rsquo;m not sure if all of this works on <a href="https://rvm.beginrescueend.com/">RVM</a> &ndash; I just need additional feedback from
people using it. Happy <em>&ldquo;Vim-ing&rdquo;</em>!</p>

<h2>Further reading</h2>

<ul>
<li><a href="http://vim.wikia.com/wiki/Building_Vim">Building Vim</a></li>
<li><a href="http://arjanvandergaag.nl/blog/compiling-vim-with-ruby-support.html">Vim with ruby support</a></li>
<li><a href="https://github.com/b4winckler/macvim/wiki/Building">Building MacVim</a></li>
</ul>


  <aside>
    You can write a comment below or <a href="http://wikimatze.wufoo.com/forms/z7x3x5/">send me an email</a>.
    <br />
    <div class="whoring">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wikimatze'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


  </aside>
</article>


      </div>
    </div>

    <footer>
      <nav>
        &copy; Matthias Günther
        &bull;
        <a href="/contact.html">contact</a>
        &bull;
        <a href="/follow.html">follow</a>
        &bull;
        <a href="/reading.html">books</a>
        &bull;
        <a rel="nofollow" href="/imprint.html">imprint</a>
        &bull;
        <a rel="nofollow" href="/colophon.html">colophon</a>
        &bull;
        <a rel="nofollow" href="/donate.html">surprise me</a>
        <span id="last-build">last build: 5-7-2013</span>
      </nav>
    </footer>
  </div> <!-- container-centered-->

  <!-- jQuery library -->
  <script type="text/javascript" src="/js/jquery-1.9.0.min.js"></script>

  <!-- Add fancyBox -->
  <link rel="stylesheet" href="/js/fancybox/source/jquery.fancybox.css?v=2.1.4" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/fancybox/source/jquery.fancybox.pack.js?v=2.1.4"></script>

  <!-- Optionally add helpers - button, thumbnail and/or media -->
  <link rel="stylesheet" href="/js/fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
  <script type="text/javascript" src="/js/fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.5"></script>

  <link rel="stylesheet" href="/js/fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
  <script type="text/javascript">
    $(document).ready(function() {
        $(".fancybox").fancybox(
          {
          wrapCSS    : 'fancybox-custom',
          closeClick : true,

          helpers : {
            title : {
              type : 'inside'
            },
            overlay : {
              css : {
                'background-color' : '#eee'
              }
            }
          }
        });
     });
   </script>

  <!-- google Analytics -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2870917-2']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</body>
</html>
